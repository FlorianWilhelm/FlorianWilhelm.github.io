<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>A Practical Comparison of Polars and Pandas - Florian Wilhelm's blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://florianwilhelm.info/2021/05/polars_pandas_comparison_notebook/">

        <meta name="author" content="Florian Wilhelm" />
        <meta name="keywords" content="data science,programming" />
        <meta name="description" content="A new star is rising in the Python ecosystem. Polars is a blazing fast DataFrames library in Rust &amp; Python with PySpark-like syntax." />

        <meta property="og:site_name" content="Florian Wilhelm's blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="A Practical Comparison of Polars and Pandas"/>
        <meta property="og:url" content="https://florianwilhelm.info/2021/05/polars_pandas_comparison_notebook/"/>
        <meta property="og:description" content="A new star is rising in the Python ecosystem. Polars is a blazing fast DataFrames library in Rust &amp; Python with PySpark-like syntax."/>
        <meta property="article:published_time" content="2021-05-24" />
            <meta property="article:section" content="post" />
            <meta property="article:tag" content="data science" />
            <meta property="article:tag" content="programming" />
            <meta property="article:author" content="Florian Wilhelm" />

    <meta name="twitter:dnt" content="on">
    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@FlorianWilhelm">
        <meta name="twitter:creator" content="@FlorianWilhelm">
    <meta name="twitter:domain" content="https://florianwilhelm.info">


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://florianwilhelm.info/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://florianwilhelm.info/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://florianwilhelm.info/theme/css/pygments/native.css" rel="stylesheet">
        <link href="https://florianwilhelm.info/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="https://florianwilhelm.info/theme/css/style.css" type="text/css"/>


        <link href="https://florianwilhelm.info/feeds/post.atom.xml" type="application/atom+xml" rel="alternate"
              title="Florian Wilhelm's blog post ATOM Feed"/>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LQCSE9V2BL"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-LQCSE9V2BL');
    </script>
    <!-- End Google Analytics Code -->
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','');</script>
    <!-- End Google Tag Manager -->

</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://florianwilhelm.info/" class="navbar-brand">
Florian Wilhelm's blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/about/">About me</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://florianwilhelm.info/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://florianwilhelm.info/2021/05/polars_pandas_comparison_notebook/"
                       rel="bookmark"
                       title="Permalink to A Practical Comparison of Polars and Pandas">
                        A Practical Comparison of Polars and&nbsp;Pandas
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2021-05-24T08:00:00+02:00"> May. 24, 2021</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://florianwilhelm.info/tag/data-science/">data science</a>
        /
	<a href="https://florianwilhelm.info/tag/programming/">programming</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <hr>
<figure>
<img class="noZoom" src="/images/polar_bear.png" alt="Polar bear holding a panda bear and asking him if he was good.">
<figcaption align="center">Didn&#8217;t know this was a thing before I googled &#8220;Panda vs Polar&#8221; accidently, Credits: <a href="https://www.pandaandpolarbear.com/">Panda <span class="amp">&amp;</span> Polar Bear</a></figcaption>
</figure>

<h2>Preface</h2>
<p>In this comparison, which is also available as <a href="https://github.com/FlorianWilhelm/polars_vs_pandas/blob/master/pl_vs_pd.ipynb">Jupyter Notebook</a> for you to try out, I demonstrate typical operations in 
Polars and Pandas side by side to show how much easier Polars is to&nbsp;use.</p>
<h3>Information about&nbsp;Polars</h3>
<ul>
<li><a href="https://pola-rs.github.io/polars-book/user-guide/introduction.html">Python&nbsp;Docs</a></li>
<li><a href="https://github.com/pola-rs/polars">Github</a></li>
<li><a href="https://pypi.org/project/polars/">PyPI</a></li>
<li>Features:<ul>
<li>Lazy <span class="amp">&amp;</span> eager&nbsp;computation</li>
<li>Rust&nbsp;implementation</li>
<li><a href="https://arrow.apache.org/">Arrow</a> memory&nbsp;layout</li>
<li>Easy and transparent parallelisation using&nbsp;multithreading</li>
<li>PySpark-like syntax and thus heavily inspired by <span class="caps">SQL</span></li>
<li>Supports real <span class="caps">NA</span> values in contrast to&nbsp;Pandas</li>
<li>Easily deal with complex data types, e.g. list of&nbsp;strings/floats</li>
<li>Copy-On-Write (<span class="caps">COW</span>) semantics in contrast to Pandas where you kind of never&nbsp;know</li>
</ul>
</li>
</ul>
<h3>Information about&nbsp;Pandas</h3>
<ul>
<li><a href="https://pandas.pydata.org/">Docs</a></li>
<li><a href="https://github.com/pandas-dev/pandas">Github</a></li>
<li><a href="https://pypi.org/project/pandas/">PyPI</a></li>
<li>Features:<ul>
<li>De facto standard data wrangling library for&nbsp;Python</li>
<li>Multi-index for rows and&nbsp;columns</li>
<li>Quite unrestricted in what&#8217;s possible, e.g. everything hashable can be a column name like integers, floats,&nbsp;enums</li>
<li>Tons of&nbsp;functionality</li>
<li>No&nbsp;parallelization</li>
<li>Built on top of&nbsp;Numpy</li>
</ul>
</li>
</ul>
<h3>Other&nbsp;Contenders</h3>
<ul>
<li><a href="https://github.com/vaexio/vaex">Vaex</a>: Lazy Out-of-Core&nbsp;dataframes</li>
<li><a href="https://docs.dask.org/">Dask</a>: Built on top of Pandas and parallelizes it, on a single node or&nbsp;distributed.</li>
<li><a href="https://github.com/h2oai/datatable"><span class="caps">H2O</span> Datatable</a>: Inspired by R&#8217;s&nbsp;data.tables</li>
<li><a href="https://modin.readthedocs.io/en/latest/">Modin</a>: Uses <a href="https://docs.ray.io/">Ray</a> or <a href="https://docs.dask.org/">Dask</a> to parallelize&nbsp;Pandas</li>
<li><a href="https://rapids.ai/"><span class="caps">RAPIDS</span></a>: Data analysis on <span class="caps">GPU</span></li>
</ul>
<p>Performance <a href="https://h2oai.github.io/db-benchmark/">benchmark</a> of various&nbsp;frameworks</p>
<h2>Prelude, or let&#8217;s get started&nbsp;:-)</h2>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">polars</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">lit</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas.io.common</span> <span class="kn">import</span> <span class="n">get_handle</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>


<div class="highlight"><pre><span></span>&#39;0.7.18&#39;
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>


<div class="highlight"><pre><span></span>&#39;1.2.4&#39;
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Download a huge csv as a test. Takes a while and only needed once...</span>
<span class="n">big_csv</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./big.csv&quot;</span><span class="p">)</span>
<span class="n">csv_url</span> <span class="o">=</span> <span class="s2">&quot;http://sdm.lbl.gov/fastbit/data/star2002-full.csv.gz&quot;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">big_csv</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">get_handle</span><span class="p">(</span><span class="n">csv_url</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh_in</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">big_csv</span><span class="p">,</span> <span class="s2">&quot;bw&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh_out</span><span class="p">:</span>
        <span class="n">fh_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fh_in</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>


<h3>Eager&nbsp;Execution</h3>
<div class="highlight"><pre><span></span><span class="n">edf</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">big_csv</span><span class="p">),</span> <span class="n">has_headers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">edf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;column_1&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;column_9&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
column_9
</th>
</tr>
<tr>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
654
</td>
</tr>
<tr>
<td>
61
</td>
</tr>
<tr>
<td>
7
</td>
</tr>
<tr>
<td>
27
</td>
</tr>
<tr>
<td>
1
</td>
</tr>
</tbody>
</table>
</div>

<h4>alternatively <em>Pandas</em> style (not&nbsp;recommended!)</h4>
<div class="highlight"><pre><span></span><span class="n">edf</span><span class="p">[</span><span class="n">edf</span><span class="p">[</span><span class="s2">&quot;column_1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;column_9&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
column_9
</th>
</tr>
<tr>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
654
</td>
</tr>
<tr>
<td>
61
</td>
</tr>
<tr>
<td>
7
</td>
</tr>
<tr>
<td>
27
</td>
</tr>
<tr>
<td>
1
</td>
</tr>
</tbody>
</table>
</div>

<p>Why shouldn&#8217;t I use the Pandas style? Because&nbsp;&#8230;</p>
<ul>
<li>it&#8217;s much harder to read since it&#8217;s not <em>operator chaining</em>,</li>
<li>it&#8217;s more verbose if you assign actual variable names to your dataframes and not just use <code>df</code> all the time. Check out this filtering example: <code>agg_metric_df[agg_metric_df["metric_1"] &lt; 0.9]</code>. Using <code>col</code> to refer to the column of the current dataframe is much&nbsp;cleaner,</li>
<li>it&#8217;s not possible to switch later from eager to lazy&nbsp;execution</li>
</ul>
<h3>Lazy&nbsp;Execution</h3>
<p>Just switching <code>read_csv</code> to <code>scan_csv</code> is all it needs to go from eager to lazy in this example. <code>collect</code> or <code>fetch</code> is then used to trigger the&nbsp;execution.</p>
<div class="highlight"><pre><span></span><span class="n">ldf</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">scan_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">big_csv</span><span class="p">),</span> <span class="n">has_headers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">ldf</span> <span class="o">=</span> <span class="n">ldf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;column_1&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ldf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;column_9&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
column_9
</th>
</tr>
<tr>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
654
</td>
</tr>
<tr>
<td>
61
</td>
</tr>
<tr>
<td>
7
</td>
</tr>
<tr>
<td>
27
</td>
</tr>
<tr>
<td>
1
</td>
</tr>
</tbody>
</table>
</div>

<p>Pandas style fails in lazy&nbsp;mode:</p>
<div class="highlight"><pre><span></span><span class="n">ldf</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">scan_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">big_csv</span><span class="p">),</span> <span class="n">has_headers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ldf</span><span class="p">[</span><span class="n">ldf</span><span class="p">[</span><span class="s2">&quot;column_1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s2">&quot;column_9&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

&lt;ipython-input-10-aaa4e676d17c&gt; in &lt;module&gt;
      1 ldf = pl.scan_csv(str(big_csv), has_headers=False)
----&gt; 2 ldf[ldf[&quot;column_1&quot;] == 1][[&quot;column_9&quot;]].head()


TypeError: &#39;LazyFrame&#39; object is not subscriptable
</pre></div>


<h3>Slicing <span class="amp">&amp;</span>&nbsp;Indexing</h3>
<p>Slicing and indexing in Polars works with the help of the subscript syntax similar to Numpy, i.e. df[1] or df[1, 2]. Some simple rules&nbsp;apply:</p>
<ul>
<li>indexing by a single&nbsp;dimension </li>
<li>returns one or several rows if indexed by an integer, e.g. <code>df[42]</code>, <code>df[42:]</code>,</li>
<li>
<p>returns one or several columns if index by a string, e.g. , <code>df["my_col"]</code>, <code>df[["col1", "col2]]</code>, </p>
</li>
<li>
<p>indexing by two&nbsp;dimensions  </p>
</li>
<li>returns the row(s) indexed by an integer in the first dimension and the column(s) indexed by integer or string in the second dimension, e.g. <code>df[69, 42]</code> or <code>df[69, "col_42"]</code></li>
</ul>
<p>In case of integers also slices, e.g. <code>1:</code>, are&nbsp;possible.</p>
<div class="highlight"><pre><span></span><span class="n">edf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># this is a bug right now</span>
</pre></div>


<div class="highlight"><pre><span></span>Series: &#39;column_2&#39; [i64]
[
    1613423
    1613423
    1613423
    1613423
    1613423
    1613423
    1613423
    1613423
    1613423
    1613423
]
</pre></div>


<div class="highlight"><pre><span></span><span class="n">edf</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
column_1
</th>
<th>
column_2
</th>
<th>
column_3
</th>
<th>
column_4
</th>
<th>
column_5
</th>
<th>
column_6
</th>
<th>
column_7
</th>
<th>
column_8
</th>
<th>
column_9
</th>
<th>
column_10
</th>
<th>
column_11
</th>
<th>
column_12
</th>
<th>
column_13
</th>
<th>
column_14
</th>
<th>
column_15
</th>
<th>
column_16
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
1613423
</td>
<td>
808
</td>
<td>
2.0011015223e7
</td>
<td>
1613424
</td>
<td>
886
</td>
<td>
0
</td>
<td>
0
</td>
<td>
61
</td>
<td>
371
</td>
<td>
2.0011204115e7
</td>
<td>
23.326
</td>
<td>
2288071
</td>
<td>
-2.47e-1
</td>
<td>
0.456
</td>
<td>
57.811
</td>
</tr>
</tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">edf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1"># index by (row, column)</span>
</pre></div>


<div class="highlight"><pre><span></span>20011015.222604
</pre></div>


<div class="highlight"><pre><span></span><span class="n">edf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;column_4&quot;</span><span class="p">]</span> <span class="c1"># or as string</span>
</pre></div>


<div class="highlight"><pre><span></span>20011015.222604
</pre></div>


<div class="highlight"><pre><span></span><span class="n">edf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>  <span class="c1"># index by (row, column) but returns data frame</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
column_3
</th>
<th>
column_4
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
808
</td>
<td>
2.0011015223e7
</td>
</tr>
</tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">edf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;column_4&quot;</span><span class="p">:]</span> <span class="c1"># slice by row and column&#39;s name</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
column_4
</th>
<th>
column_5
</th>
<th>
column_6
</th>
<th>
column_7
</th>
<th>
column_8
</th>
<th>
column_9
</th>
<th>
column_10
</th>
<th>
column_11
</th>
<th>
column_12
</th>
<th>
column_13
</th>
<th>
column_14
</th>
<th>
column_15
</th>
<th>
column_16
</th>
</tr>
<tr>
<td>
f64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
2.0011015223e7
</td>
<td>
1613424
</td>
<td>
886
</td>
<td>
0
</td>
<td>
0
</td>
<td>
61
</td>
<td>
371
</td>
<td>
2.0011204115e7
</td>
<td>
23.326
</td>
<td>
2288071
</td>
<td>
-2.47e-1
</td>
<td>
0.456
</td>
<td>
57.811
</td>
</tr>
<tr>
<td>
2.0011015223e7
</td>
<td>
1613424
</td>
<td>
638
</td>
<td>
0
</td>
<td>
0
</td>
<td>
7
</td>
<td>
121
</td>
<td>
2.0011204115e7
</td>
<td>
2.444
</td>
<td>
2288071
</td>
<td>
-3.91e-1
</td>
<td>
0.59
</td>
<td>
167.757
</td>
</tr>
<tr>
<td>
2.0011015223e7
</td>
<td>
1613424
</td>
<td>
4259
</td>
<td>
0
</td>
<td>
0
</td>
<td>
1024
</td>
<td>
1302
</td>
<td>
2.0011204115e7
</td>
<td>
9.522
</td>
<td>
2288071
</td>
<td>
-2.9e-1
</td>
<td>
0.446
</td>
<td>
8.644
</td>
</tr>
</tbody>
</table>
</div>

<p>Since in Pandas there is an explicit index that can be any type, not just integer and columns that can have any immutable datatype, it has to workaround several ambiguities with special accessors like <code>iloc</code>, <code>loc</code>, <code>at</code>, <code>iat</code>,&nbsp;etc.</p>
<div class="highlight"><pre><span></span><span class="n">pdf</span> <span class="o">=</span> <span class="n">edf</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span>20011015.222604
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># when mixing indexing by integer and by string it gets less comprehensible in Pandas</span>
<span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;column_4&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
</pre></div>


<div class="highlight"><pre><span></span>20011015.222604
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>


<div class="highlight"><pre><span></span>column_3    8.080000e+02
column_4    2.001102e+07
Name: 1, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pdf</span><span class="p">[[</span><span class="s2">&quot;column_4&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>column_4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2.001102e+07</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.001102e+07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.001102e+07</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1"># for slicing with column names and guaranteed indexing by integer we have to write:</span>
<span class="n">pdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;column_4&quot;</span><span class="p">:]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="c1"># `pdf.loc[1:4, &quot;column_4&quot;:]` works only as long the index is set correctly.</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>column_4</th>
      <th>column_5</th>
      <th>column_6</th>
      <th>column_7</th>
      <th>column_8</th>
      <th>column_9</th>
      <th>column_10</th>
      <th>column_11</th>
      <th>column_12</th>
      <th>column_13</th>
      <th>column_14</th>
      <th>column_15</th>
      <th>column_16</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2.001102e+07</td>
      <td>1613424</td>
      <td>886</td>
      <td>0</td>
      <td>0</td>
      <td>61</td>
      <td>371</td>
      <td>2.001120e+07</td>
      <td>23.326479</td>
      <td>2288071</td>
      <td>-0.247330</td>
      <td>0.455916</td>
      <td>57.810596</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.001102e+07</td>
      <td>1613424</td>
      <td>638</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>121</td>
      <td>2.001120e+07</td>
      <td>2.444299</td>
      <td>2288071</td>
      <td>-0.390961</td>
      <td>0.589534</td>
      <td>167.757140</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.001102e+07</td>
      <td>1613424</td>
      <td>4259</td>
      <td>0</td>
      <td>0</td>
      <td>1024</td>
      <td>1302</td>
      <td>2.001120e+07</td>
      <td>9.521868</td>
      <td>2288071</td>
      <td>-0.290154</td>
      <td>0.446027</td>
      <td>8.644362</td>
    </tr>
  </tbody>
</table>
</div>

<h3>Dealing with missing&nbsp;values</h3>
<div class="highlight"><pre><span></span><span class="n">left_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]})</span>
<span class="n">right_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">69</span><span class="p">]})</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">left_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">right_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
a
</th>
<th>
b
</th>
<th>
c
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
str
</td>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
null
</td>
<td>
42
</td>
</tr>
<tr>
<td>
2
</td>
<td>
&#8220;b&#8221;
</td>
<td>
69
</td>
</tr>
<tr>
<td>
3
</td>
<td>
&#8220;c&#8221;
</td>
<td>
null
</td>
</tr>
</tbody>
</table>
</div>

<p>Note that the last element of the <code>c</code> column is <code>null</code>, not <code>NaN</code> as in Pandas, and the datatype is still int and not automatically converted to float as in&nbsp;Pandas.</p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_null</span><span class="p">())</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
a
</th>
<th>
b
</th>
<th>
c
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
str
</td>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
3
</td>
<td>
&#8220;c&#8221;
</td>
<td>
null
</td>
</tr>
</tbody>
</table>
</div>

<p>Pandas does something pretty scary&nbsp;here</p>
<div class="highlight"><pre><span></span><span class="n">left_pdf</span> <span class="o">=</span> <span class="n">left_df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">right_pdf</span> <span class="o">=</span> <span class="n">right_df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>


<p>Note that &#8220;c&#8221;-column has type&nbsp;int:</p>
<div class="highlight"><pre><span></span><span class="n">right_pdf</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>


<div class="highlight"><pre><span></span>a    int64
c    int64
dtype: object
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left_pdf</span><span class="p">,</span> <span class="n">right_pdf</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pdf</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>None</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>b</td>
      <td>69.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>c</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<p>Depending on the datatype, Pandas shows <code>None</code> or <code>NaN</code>, also note that the column <code>c</code> was converted from <code>int</code> to <code>float</code> without our&nbsp;consent!</p>
<h1>New&nbsp;columns</h1>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">with_column</span><span class="p">((</span><span class="n">lit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;3*c&quot;</span><span class="p">))</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
a
</th>
<th>
b
</th>
<th>
c
</th>
<th>
3*c
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
str
</td>
<td>
i64
</td>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
null
</td>
<td>
42
</td>
<td>
126
</td>
</tr>
<tr>
<td>
2
</td>
<td>
&#8220;b&#8221;
</td>
<td>
69
</td>
<td>
207
</td>
</tr>
<tr>
<td>
3
</td>
<td>
&#8220;c&#8221;
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
</tbody>
</table>
</div>

<p>Same is possible in Pandas but note that we have to retype again the variable name <code>pdf</code> just to access a&nbsp;column!</p>
<div class="highlight"><pre><span></span><span class="n">pdf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;3*c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="o">*</span><span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]})</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>3*c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>None</td>
      <td>42.0</td>
      <td>126.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>b</td>
      <td>69.0</td>
      <td>207.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>c</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<h1>Column&nbsp;Expressions</h1>
<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;nrs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s2">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;ham&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;egg&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="s2">&quot;random&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
        <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">df</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
nrs
</th>
<th>
names
</th>
<th>
random
</th>
<th>
groups
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
str
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
&#8220;foo&#8221;
</td>
<td>
0.27
</td>
<td>
&#8220;A&#8221;
</td>
</tr>
<tr>
<td>
2
</td>
<td>
&#8220;ham&#8221;
</td>
<td>
0.521
</td>
<td>
&#8220;A&#8221;
</td>
</tr>
<tr>
<td>
3
</td>
<td>
&#8220;spam&#8221;
</td>
<td>
0.825
</td>
<td>
&#8220;B&#8221;
</td>
</tr>
<tr>
<td>
null
</td>
<td>
&#8220;egg&#8221;
</td>
<td>
0.621
</td>
<td>
&#8220;C&#8221;
</td>
</tr>
<tr>
<td>
5
</td>
<td>
null
</td>
<td>
0.891
</td>
<td>
&#8220;B&#8221;
</td>
</tr>
</tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1"># and in Pandas</span>
<span class="n">pdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>


<h4>Construct a new dataframe with a sorted column and some&nbsp;aggregations</h4>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;nrs&quot;</span><span class="p">),</span> <span class="c1"># or equivalently col(&quot;nrs&quot;).sum()</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">n_unique</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;unique_names_1&quot;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
nrs
</th>
<th>
names
</th>
<th>
unique_names_1
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
str
</td>
<td>
u32
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
11
</td>
<td>
null
</td>
<td>
5
</td>
</tr>
<tr>
<td>
11
</td>
<td>
&#8220;egg&#8221;
</td>
<td>
5
</td>
</tr>
<tr>
<td>
11
</td>
<td>
&#8220;foo&#8221;
</td>
<td>
5
</td>
</tr>
<tr>
<td>
11
</td>
<td>
&#8220;ham&#8221;
</td>
<td>
5
</td>
</tr>
<tr>
<td>
11
</td>
<td>
&#8220;spam&#8221;
</td>
<td>
5
</td>
</tr>
</tbody>
</table>
</div>

<p>In Pandas we create a new DataFrame and reference several times <code>pdf</code></p>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;nrs&quot;</span><span class="p">:</span> <span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;nrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
        <span class="s2">&quot;names&quot;</span><span class="p">:</span> <span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(),</span>
        <span class="s2">&quot;unique_names_1&quot;</span><span class="p">:</span> <span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nrs</th>
      <th>names</th>
      <th>unique_names_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>11.0</td>
      <td>egg</td>
      <td>5</td>
    </tr>
    <tr>
      <th>0</th>
      <td>11.0</td>
      <td>foo</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11.0</td>
      <td>ham</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11.0</td>
      <td>spam</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11.0</td>
      <td>None</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Select certain elements from a column by filtering from&nbsp;another</h4>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">))</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
names
</th>
</tr>
<tr>
<td>
str
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
&#8220;ham&#8221;
</td>
</tr>
<tr>
<td>
&#8220;spam&#8221;
</td>
</tr>
<tr>
<td>
&#8220;egg&#8221;
</td>
</tr>
<tr>
<td>
null
</td>
</tr>
</tbody>
</table>
</div>

<p>Syntax in Pandas is way less&nbsp;readable</p>
<div class="highlight"><pre><span></span><span class="n">pdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">][[</span><span class="s2">&quot;names&quot;</span><span class="p">]]</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>ham</td>
    </tr>
    <tr>
      <th>2</th>
      <td>spam</td>
    </tr>
    <tr>
      <th>3</th>
      <td>egg</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<p>Another way in Pandas is to use the query&nbsp;style:</p>
<div class="highlight"><pre><span></span><span class="n">pdf</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;random &gt; 0.4&quot;</span><span class="p">)[[</span><span class="s2">&quot;names&quot;</span><span class="p">]]</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>ham</td>
    </tr>
    <tr>
      <th>2</th>
      <td>spam</td>
    </tr>
    <tr>
      <th>3</th>
      <td>egg</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<p>The problem with Pandas&#8217; query style is that it is basically string hacking with no checks whatsoever until the code is executed. Also reuse of certain expressions is highly limited if you have just&nbsp;strings.</p>
<h3>Complex expressions are also&nbsp;possible</h3>
<p>All expressions in Polars are <em>embarassingly parallel</em> by design and thus automatically&nbsp;parallelized</p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;nrs&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">pl</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">))</span>
        <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
result
</th>
</tr>
<tr>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
2.973
</td>
</tr>
<tr>
<td>
0.0
</td>
</tr>
<tr>
<td>
0.0
</td>
</tr>
<tr>
<td>
0.0
</td>
</tr>
<tr>
<td>
0.0
</td>
</tr>
</tbody>
</table>
</div>

<p><span class="caps">SQL</span>-like <code>when</code>/<code>then</code>/<code>otherwise</code> statements are not possible in Pandas, thus we have to use <code>np.where</code>:</p>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;nrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;result&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.973213</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1"># or easier to read but much slower since not vectorized at all</span>
<span class="n">pdf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="n">x</span> <span class="o">*</span> <span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;nrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>random</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.973213</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Even window expressions are&nbsp;possible</h4>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">),</span>  <span class="c1"># select all</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="s2">&quot;groups&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;sum[random]/groups&quot;</span><span class="p">),</span>
        <span class="n">col</span><span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">list</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;random/name&quot;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
nrs
</th>
<th>
names
</th>
<th>
random
</th>
<th>
groups
</th>
<th>
sum[random]/groups
</th>
<th>
random/name
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
list
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
&#8220;foo&#8221;
</td>
<td>
0.27
</td>
<td>
&#8220;A&#8221;
</td>
<td>
0.791
</td>
<td>
&#8220;[0.2702920925095984]&#8221;
</td>
</tr>
<tr>
<td>
2
</td>
<td>
&#8220;ham&#8221;
</td>
<td>
0.521
</td>
<td>
&#8220;A&#8221;
</td>
<td>
0.791
</td>
<td>
&#8220;[0.5210243165448514]&#8221;
</td>
</tr>
<tr>
<td>
3
</td>
<td>
&#8220;spam&#8221;
</td>
<td>
0.825
</td>
<td>
&#8220;B&#8221;
</td>
<td>
1.716
</td>
<td>
&#8220;[0.8248294839356618]&#8221;
</td>
</tr>
<tr>
<td>
null
</td>
<td>
&#8220;egg&#8221;
</td>
<td>
0.621
</td>
<td>
&#8220;C&#8221;
</td>
<td>
0.621
</td>
<td>
&#8220;[0.6213192138749672]&#8221;
</td>
</tr>
<tr>
<td>
5
</td>
<td>
null
</td>
<td>
0.891
</td>
<td>
&#8220;B&#8221;
</td>
<td>
1.716
</td>
<td>
&#8220;[0.8909539423562371]&#8221;
</td>
</tr>
</tbody>
</table>
</div>

<p>Doing the same in Pandas is a bit more complex. Also note that there is an unexpected <code>NaN</code> in the last row. This is due to the fact that when inserting <code>pdf.groupby(['names'], dropna=False)['random'].apply(list)</code> we compare <code>NaN</code> to <code>NaN</code> which is false by definition. This is just another subtle problem caused by the fact that Pandas uses <code>NaN</code> to express <code>NA</code>.
Also note that Polars needs no explicit index like Pandas to do operations like this, just like Spark has no way to set an index&nbsp;explicitely.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;groups&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;sum[random]/groups&quot;</span><span class="p">:</span> <span class="n">pdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;groups&#39;</span><span class="p">])[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()})</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;random/name&quot;</span><span class="p">:</span> <span class="n">pdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;names&#39;</span><span class="p">],</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>names</th>
      <th>nrs</th>
      <th>random</th>
      <th>sum[random]/groups</th>
      <th>random/name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>foo</td>
      <td>1.0</td>
      <td>0.270292</td>
      <td>0.791316</td>
      <td>[0.2702920925095984]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ham</td>
      <td>2.0</td>
      <td>0.521024</td>
      <td>0.791316</td>
      <td>[0.5210243165448514]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>spam</td>
      <td>3.0</td>
      <td>0.824829</td>
      <td>1.715783</td>
      <td>[0.8248294839356618]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>egg</td>
      <td>NaN</td>
      <td>0.621319</td>
      <td>0.621319</td>
      <td>[0.6213192138749672]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
      <td>5.0</td>
      <td>0.890954</td>
      <td>1.715783</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1"># or alternatively using `join` which is also avoiding the NaN problem</span>
<span class="n">pdf</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;sum[random]/groups&quot;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;groups&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;random/name&quot;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;names&quot;</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nrs</th>
      <th>names</th>
      <th>random</th>
      <th>groups</th>
      <th>sum[random]/groups</th>
      <th>random/name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>foo</td>
      <td>0.270292</td>
      <td>A</td>
      <td>0.791316</td>
      <td>[0.2702920925095984]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>ham</td>
      <td>0.521024</td>
      <td>A</td>
      <td>0.791316</td>
      <td>[0.5210243165448514]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>spam</td>
      <td>0.824829</td>
      <td>B</td>
      <td>1.715783</td>
      <td>[0.8248294839356618]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>egg</td>
      <td>0.621319</td>
      <td>C</td>
      <td>0.621319</td>
      <td>[0.6213192138749672]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>None</td>
      <td>0.890954</td>
      <td>B</td>
      <td>1.715783</td>
      <td>[0.8909539423562371]</td>
    </tr>
  </tbody>
</table>
</div>

<h1>GroupBy</h1>
<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://theunitedstates.io/congress-legislators/legislators-current.csv&quot;</span><span class="p">)</span>
<span class="n">pdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>  <span class="c1"># allows for working only on a subset using limit</span>
   <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;first_name&quot;</span><span class="p">)</span>
   <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
       <span class="p">[</span>
           <span class="n">col</span><span class="p">(</span><span class="s2">&quot;party&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;n_party&quot;</span><span class="p">),</span>  <span class="c1"># renaming an aggregated column is a bliss</span>
           <span class="n">col</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">list</span><span class="p">(),</span>
           <span class="n">col</span><span class="p">(</span><span class="s2">&quot;last_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">(),</span>
       <span class="p">]</span>
   <span class="p">)</span>
   <span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;n_party&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
   <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
first_name
</th>
<th>
n_party
</th>
<th>
gender_agg_list
</th>
<th>
last_name_first
</th>
</tr>
<tr>
<td>
str
</td>
<td>
u32
</td>
<td>
list
</td>
<td>
str
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
&#8220;John&#8221;
</td>
<td>
19
</td>
<td>
&#8220;[M, M, &#8230; M]&#8221;
</td>
<td>
&#8220;Barrasso&#8221;
</td>
</tr>
<tr>
<td>
&#8220;Mike&#8221;
</td>
<td>
12
</td>
<td>
&#8220;[M, M, &#8230; M]&#8221;
</td>
<td>
&#8220;Kelly&#8221;
</td>
</tr>
<tr>
<td>
&#8220;Michael&#8221;
</td>
<td>
11
</td>
<td>
&#8220;[M, M, &#8230; M]&#8221;
</td>
<td>
&#8220;Bennet&#8221;
</td>
</tr>
<tr>
<td>
&#8220;David&#8221;
</td>
<td>
11
</td>
<td>
&#8220;[M, M, &#8230; M]&#8221;
</td>
<td>
&#8220;Cicilline&#8221;
</td>
</tr>
<tr>
<td>
&#8220;James&#8221;
</td>
<td>
9
</td>
<td>
&#8220;[M, M, &#8230; M]&#8221;
</td>
<td>
&#8220;Inhofe&#8221;
</td>
</tr>
</tbody>
</table>
</div>

<p>Note how easily we can deal with lists of strings by aggregating over gender using <code>list()</code>.</p>
<p>In Pandas the same operation feels more like string hacking and renaming happens as a separate step having unnecessary repetitions of the column names. Everything is of course eagerly&nbsp;evaluated.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;first_name&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;party&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> 
          <span class="s2">&quot;gender&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">grp</span><span class="p">:</span> <span class="n">grp</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> 
          <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;party&quot;</span><span class="p">:</span> <span class="s2">&quot;n_party&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;gender&quot;</span><span class="p">:</span> <span class="s2">&quot;gender_agg_list&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="s2">&quot;last_name_first&quot;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;n_party&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>first_name</th>
      <th>n_party</th>
      <th>gender_agg_list</th>
      <th>last_name_first</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>John</td>
      <td>19</td>
      <td>[M, M, M, M, M, M, M, M, M, M, M, M, M, M, M, &#8230;</td>
      <td>Barrasso</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mike</td>
      <td>12</td>
      <td>[M, M, M, M, M, M, M, M, M, M, M, M]</td>
      <td>Kelly</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Michael</td>
      <td>11</td>
      <td>[M, M, M, M, M, M, M, M, M, M, M]</td>
      <td>Bennet</td>
    </tr>
    <tr>
      <th>3</th>
      <td>David</td>
      <td>11</td>
      <td>[M, M, M, M, M, M, M, M, M, M, M]</td>
      <td>Cicilline</td>
    </tr>
    <tr>
      <th>4</th>
      <td>James</td>
      <td>9</td>
      <td>[M, M, M, M, M, M, M, M, M]</td>
      <td>Inhofe</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Conditionals in&nbsp;aggregations</h4>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
   <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
   <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
       <span class="p">[</span>
           <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;party&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Democrat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">),</span>
           <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;party&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Republican&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;rep&quot;</span><span class="p">),</span>
       <span class="p">]</span>
   <span class="p">)</span>
   <span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
   <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
state
</th>
<th>
demo
</th>
<th>
rep
</th>
</tr>
<tr>
<td>
str
</td>
<td>
u32
</td>
<td>
u32
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
&#8220;<span class="caps">CA</span>&#8221;
</td>
<td>
44
</td>
<td>
11
</td>
</tr>
<tr>
<td>
&#8220;<span class="caps">NY</span>&#8221;
</td>
<td>
21
</td>
<td>
8
</td>
</tr>
<tr>
<td>
&#8220;<span class="caps">IL</span>&#8221;
</td>
<td>
15
</td>
<td>
5
</td>
</tr>
<tr>
<td>
&#8220;<span class="caps">TX</span>&#8221;
</td>
<td>
13
</td>
<td>
24
</td>
</tr>
<tr>
<td>
&#8220;<span class="caps">NJ</span>&#8221;
</td>
<td>
12
</td>
<td>
2
</td>
</tr>
</tbody>
</table>
</div>

<p>The translation to Pandas is &#8220;somewhat&#8221; more complicated&#8230; kudos to everyone able to solve this without looking it up on StackOverflow&nbsp;:-) </p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;party&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;demo&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">grp</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">grp</span> <span class="o">==</span> <span class="s2">&quot;Democrat&quot;</span><span class="p">)),</span> 
                    <span class="p">(</span><span class="s2">&quot;rep&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">grp</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">grp</span> <span class="o">==</span> <span class="s2">&quot;Republican&quot;</span><span class="p">))]})</span>
    <span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;demo&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>demo</th>
      <th>rep</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td><span class="caps">CA</span></td>
      <td>44</td>
      <td>11</td>
    </tr>
    <tr>
      <th>37</th>
      <td><span class="caps">NY</span></td>
      <td>21</td>
      <td>8</td>
    </tr>
    <tr>
      <th>16</th>
      <td><span class="caps">IL</span></td>
      <td>15</td>
      <td>5</td>
    </tr>
    <tr>
      <th>47</th>
      <td><span class="caps">TX</span></td>
      <td>13</td>
      <td>24</td>
    </tr>
    <tr>
      <th>34</th>
      <td><span class="caps">NJ</span></td>
      <td>12</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Composition and reuse of more complex&nbsp;operations</h4>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_age</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
    <span class="c1"># Date64 is time in ms</span>
    <span class="n">ms_to_year</span> <span class="o">=</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">365</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">lit</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">col</span><span class="p">(</span><span class="s2">&quot;birthday&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ms_to_year</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">avg_age</span><span class="p">(</span><span class="n">gender</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">compute_age</span><span class="p">()</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">gender</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;avg </span><span class="si">{</span><span class="n">gender</span><span class="si">}</span><span class="s2"> age&quot;</span><span class="p">)</span>
    <span class="p">)</span>


<span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
   <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;state&quot;</span><span class="p">])</span>
   <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
       <span class="p">[</span>
            <span class="n">avg_age</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">),</span>
            <span class="n">avg_age</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">),</span>
       <span class="p">]</span>
   <span class="p">)</span>
   <span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
   <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
   <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
state
</th>
<th>
avg M age
</th>
<th>
avg F age
</th>
</tr>
<tr>
<td>
str
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
&#8220;<span class="caps">AK</span>&#8221;
</td>
<td>
71.899
</td>
<td>
63.657
</td>
</tr>
<tr>
<td>
&#8220;<span class="caps">AL</span>&#8221;
</td>
<td>
65.167
</td>
<td>
56.038
</td>
</tr>
<tr>
<td>
&#8220;<span class="caps">AR</span>&#8221;
</td>
<td>
58.325
</td>
<td>
null
</td>
</tr>
<tr>
<td>
&#8220;<span class="caps">AS</span>&#8221;
</td>
<td>
null
</td>
<td>
73.06
</td>
</tr>
<tr>
<td>
&#8220;<span class="caps">AZ</span>&#8221;
</td>
<td>
60.004
</td>
<td>
59.168
</td>
</tr>
</tbody>
</table>
</div>

<p>Translating this to Pandas is really hard since we have no way to refer to a column. Also with Pandas&#8217; <code>agg</code> we have only access to the aggregation column and cannot filter by another, thus we have to use <code>apply</code>.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">p_compute_age</span><span class="p">(</span><span class="n">grp</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="c1"># Date64 is time in ms</span>
    <span class="n">s_to_year</span> <span class="o">=</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">365</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grp</span><span class="p">[</span><span class="s2">&quot;birthday&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s_to_year</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">p_avg_age</span><span class="p">(</span><span class="n">grp</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">gender</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">p_compute_age</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span>
    <span class="n">mean_age</span> <span class="o">=</span> <span class="n">age</span><span class="p">[</span><span class="n">grp</span><span class="p">[</span><span class="s2">&quot;gender&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gender</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">mean_age</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;avg </span><span class="si">{</span><span class="n">gender</span><span class="si">}</span><span class="s2"> age&quot;</span><span class="p">])</span>


<span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">grp</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">p_avg_age</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">),</span>
             <span class="n">p_avg_age</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)]</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>avg M age</th>
      <th>avg F age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td><span class="caps">AK</span></td>
      <td>71.898630</td>
      <td>63.657534</td>
    </tr>
    <tr>
      <th>1</th>
      <td><span class="caps">AL</span></td>
      <td>65.167466</td>
      <td>56.038356</td>
    </tr>
    <tr>
      <th>2</th>
      <td><span class="caps">AR</span></td>
      <td>58.324658</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td><span class="caps">AS</span></td>
      <td>NaN</td>
      <td>73.060274</td>
    </tr>
    <tr>
      <th>4</th>
      <td><span class="caps">AZ</span></td>
      <td>60.003767</td>
      <td>59.168037</td>
    </tr>
  </tbody>
</table>
</div>

<p>The same code in Pandas just feels not as clean as in Polars, thus showing nicely the power that comes with Polars&#8217; composable&nbsp;expressions.</p>
<h1>User-Defined (Aggregation)&nbsp;Functions</h1>
<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> 
                   <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> 
                   <span class="s2">&quot;cls&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)})</span>
<span class="n">pdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
foo
</th>
<th>
bar
</th>
<th>
cls
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
f64
</td>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
0
</td>
<td>
0.232
</td>
<td>
0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
0.359
</td>
<td>
0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
0.404
</td>
<td>
1
</td>
</tr>
<tr>
<td>
3
</td>
<td>
0.855
</td>
<td>
0
</td>
</tr>
<tr>
<td>
4
</td>
<td>
0.794
</td>
<td>
1
</td>
</tr>
<tr>
<td>
5
</td>
<td>
0.598
</td>
<td>
1
</td>
</tr>
<tr>
<td>
6
</td>
<td>
0.747
</td>
<td>
1
</td>
</tr>
<tr>
<td>
7
</td>
<td>
0.656
</td>
<td>
0
</td>
</tr>
<tr>
<td>
8
</td>
<td>
0.999
</td>
<td>
0
</td>
</tr>
<tr>
<td>
9
</td>
<td>
0.769
</td>
<td>
1
</td>
</tr>
</tbody>
</table>
</div>

<h4>Vector&nbsp;Operations</h4>
<p>Use <code>map</code> for vector operations on a whole column, i.e. series -&gt;&nbsp;series:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_custom_func</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">my_custom_func</span><span class="p">,</span> <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
foo
</th>
<th>
bar
</th>
<th>
cls
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
f64
</td>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
0
</td>
<td>
0.232
</td>
<td>
0
</td>
</tr>
</tbody>
</table>
</div>

<p>Use <code>apply</code> for scalar operations on a cell or group level but returning a&nbsp;scalar:</p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
bar
</th>
</tr>
<tr>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
0.696
</td>
</tr>
<tr>
<td>
1.078
</td>
</tr>
<tr>
<td>
1.211
</td>
</tr>
<tr>
<td>
2.566
</td>
</tr>
<tr>
<td>
2.383
</td>
</tr>
<tr>
<td>
1.794
</td>
</tr>
<tr>
<td>
2.24
</td>
</tr>
<tr>
<td>
1.967
</td>
</tr>
<tr>
<td>
2.996
</td>
</tr>
<tr>
<td>
2.308
</td>
</tr>
</tbody>
</table>
</div>

<p>In Pandas, you have <code>apply</code> and <code>applymap</code> working quite&nbsp;similarily:</p>
<div class="highlight"><pre><span></span><span class="n">pdf</span><span class="p">[</span><span class="n">pdf</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">my_custom_func</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>foo</th>
      <th>bar</th>
      <th>cls</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.232159</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">pdf</span><span class="p">[[</span><span class="s2">&quot;bar&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bar</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.696478</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.078346</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.211216</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.566302</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.382630</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.793900</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2.239719</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.966602</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2.995891</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2.307976</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Aggregation&nbsp;Operations</h4>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;cls&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">grp</span><span class="p">:</span> <span class="mi">3</span><span class="o">*</span><span class="n">grp</span><span class="o">.</span><span class="n">sum</span><span class="p">())])</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1 "class="dataframe ">
<thead>
<tr>
<th>
cls
</th>
<th>

</th>
</tr>
<tr>
<td>
i64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
0
</td>
<td>
9.304
</td>
</tr>
<tr>
<td>
1
</td>
<td>
9.935
</td>
</tr>
</tbody>
</table>
</div>

<p>Quite analogous in Pandas but of course you need to fight the&nbsp;multi-index:</p>
<div class="highlight"><pre><span></span><span class="n">pdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cls&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">grp</span><span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">grp</span><span class="o">.</span><span class="n">sum</span><span class="p">()})</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cls</th>
      <th>bar</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>9.303619</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>9.935442</td>
    </tr>
  </tbody>
</table>
</div>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://florianwilhelm.info/2022/10/forget_about_ai_and_do_mathematical_modelling_instead/">Forget about <span class="caps">AI</span> and do Mathematical Modelling&nbsp;instead!</a></li>
        <li><a href="https://florianwilhelm.info/2021/09/mf_for_collaborative_filtering_is_just_solving_an_adjoint_lda_model/">Matrix Factorization for Collaborative Filtering Is Just Solving an Adjoint Latent Dirichlet Allocation Model After&nbsp;All</a></li>
        <li><a href="https://florianwilhelm.info/2021/08/using_bigquery_with_programmatic_sql/">Using Google BigQuery with Programmatic <span class="caps">SQL</span></a></li>
        <li><a href="https://florianwilhelm.info/2020/10/bayesian_hierarchical_modelling_at_scale/">Finally! Bayesian Hierarchical Modelling at&nbsp;Scale</a></li>
        <li><a href="https://florianwilhelm.info/2020/05/honey_i_shrunk_the_target_variable/">Honey, I shrunk the target&nbsp;variable</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'florianwilhelmblog'; // required: replace example with your forum shortname

            var disqus_config = function () {
                this.language = "en";

                        this.page.identifier = '2021-05-24-polars_pandas_comparison_notebook';
                        this.page.url = 'https://florianwilhelm.info/2021/05/polars_pandas_comparison_notebook/';
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="https://linkedin.com/in/florian-wilhelm-621ba834"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>
    <li class="list-group-item"><a href="https://github.com/FlorianWilhelm"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="https://florianwilhelm.info/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-3">
      <a href="https://florianwilhelm.info/tag/ai/">ai</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/airbyte/">airbyte</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/asynchronous/">asynchronous</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/asyncio/">asyncio</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/bayesian/">bayesian</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://florianwilhelm.info/tag/big-data/">big data</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/bokeh/">bokeh</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/causal-inference/">causal inference</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/conference/">conference</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://florianwilhelm.info/tag/configuration/">configuration</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://florianwilhelm.info/tag/data-science/">data science</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/dbt/">dbt</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/deep-learning/">deep learning</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/event-driven/">event-driven</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/gans/">GANs</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/google-hangouts/">google hangouts</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/gps/">gps</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/hadoop/">hadoop</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/hive/">hive</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/integer-programming/">integer programming</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://florianwilhelm.info/tag/jupyter/">jupyter</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/kalman-filter/">kalman filter</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/lightdash/">lightdash</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://florianwilhelm.info/tag/machine-learning/">machine-learning</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://florianwilhelm.info/tag/mathematics/">mathematics</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/ml/">ml</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/nlp/">nlp</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://florianwilhelm.info/tag/predictive-analytics/">predictive analytics</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://florianwilhelm.info/tag/production/">production</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://florianwilhelm.info/tag/programming/">programming</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://florianwilhelm.info/tag/python/">python</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://florianwilhelm.info/tag/recommender-systems/">recommender systems</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://florianwilhelm.info/tag/scikit-learn/">scikit-learn</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/scipy/">scipy</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/semi-supervised/">semi-supervised</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://florianwilhelm.info/tag/snowflake/">snowflake</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://florianwilhelm.info/tag/spark/">spark</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://florianwilhelm.info/tag/template/">template</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://florianwilhelm.info/tag/uncertainty-quantification/">uncertainty quantification</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2024 Florian Wilhelm
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://florianwilhelm.info/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://florianwilhelm.info/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://florianwilhelm.info/theme/js/respond.min.js"></script>


    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'florianwilhelmblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->


<script>
   $(document).ready(function () {
      $("table").attr("class","table table-condensed table-bordered");
   });
</script>
</body>
</html>