<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Data Science in Production: Packaging and Continuous Integration - Florian Wilhelm</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

/*some stuff for output/input prompts*/
div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
@media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
div.prompt:empty{padding-top:0;padding-bottom:0}
div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
div.inner_cell{width:90%;}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
div.input_prompt{color:navy;border-top:1px solid transparent;}
div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
div.output_prompt{color:darkred;}

a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
/* end stuff for output/input prompts*/


.highlight-ipynb .hll { background-color: #ffffcc }
.highlight-ipynb  { background: #f8f8f8; }
.highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
.highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
.highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
.highlight-ipynb .o { color: #666666 } /* Operator */
.highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
.highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
.highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
.highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
.highlight-ipynb .go { color: #888888 } /* Generic.Output */
.highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
.highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
.highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
.highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
.highlight-ipynb .m { color: #666666 } /* Literal.Number */
.highlight-ipynb .s { color: #BA2121 } /* Literal.String */
.highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
.highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
.highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight-ipynb .no { color: #880000 } /* Name.Constant */
.highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
.highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight-ipynb .nf { color: #0000FF } /* Name.Function */
.highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
.highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight-ipynb .nv { color: #19177C } /* Name.Variable */
.highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
.highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
.highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
.highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
.highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
.highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
.highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
.highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
.highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
.highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
.highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
.highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}
</style>

<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>

<link rel="canonical" href="http://www.florianwilhelm.info/drafts/ds_in_prod_packaging_ci.html">

        <meta name="author" content="Florian Wilhelm" />
        <meta name="keywords" content="python,data science,production" />
        <meta name="description" content="Motivation A common pattern in most data science projects I participated in is that it’s all fun and games until someone wants to put it into production. From that point in time on no one will any longer give you a pat on the back for a high accuracy …" />

        <meta property="og:site_name" content="Florian Wilhelm" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Data Science in Production: Packaging and Continuous Integration"/>
        <meta property="og:url" content="http://www.florianwilhelm.info/drafts/ds_in_prod_packaging_ci.html"/>
        <meta property="og:description" content="Motivation A common pattern in most data science projects I participated in is that it’s all fun and games until someone wants to put it into production. From that point in time on no one will any longer give you a pat on the back for a high accuracy …"/>
        <meta property="article:published_time" content="2018-01-15" />
            <meta property="article:section" content="post" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="data science" />
            <meta property="article:tag" content="production" />
            <meta property="article:author" content="Florian Wilhelm" />

    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@FlorianWilhelm">
        <meta name="twitter:creator" content="@FlorianWilhelm">
    <meta name="twitter:domain" content="http://www.florianwilhelm.info">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://www.florianwilhelm.info/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://www.florianwilhelm.info/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://www.florianwilhelm.info/theme/css/pygments/native.css" rel="stylesheet">
        <link href="http://www.florianwilhelm.info/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://www.florianwilhelm.info/theme/css/style.css" type="text/css"/>




        <link href="http://www.florianwilhelm.info/feeds/post.atom.xml" type="application/atom+xml" rel="alternate"
              title="Florian Wilhelm post ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://www.florianwilhelm.info/" class="navbar-brand">
Florian Wilhelm            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="/about/">About me</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://www.florianwilhelm.info/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://www.florianwilhelm.info/drafts/ds_in_prod_packaging_ci.html"
                       rel="bookmark"
                       title="Permalink to Data Science in Production: Packaging and Continuous Integration">
                        Data Science in Production: Packaging and Continuous&nbsp;Integration
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-01-15T18:00:00+01:00"> Jan. 15, 2018</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="http://www.florianwilhelm.info/tag/python/">python</a>
        /
	<a href="http://www.florianwilhelm.info/tag/data-science/">data science</a>
        /
	<a href="http://www.florianwilhelm.info/tag/production/">production</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h1>Motivation</h1>
<p>A common pattern in most data science projects I participated in is that it&#8217;s all 
fun and games until someone wants to put it into production. From that point in time on
no one will any longer give you a pat on the back for a high accuracy and smart
algorithm. All of a sudden the crucial question is how to deploy your model,
which version, how can updates be rolled out, which requirements are needed and so&nbsp;on.</p>
<p>The worst case in such a moment is to realize that up until now the glorious proof of concept
model is not an application but rather a stew of Python/R scripts which were deployed 
by cloning a git repo and run by some Jenkins jobs with a dash of&nbsp;Bash.</p>
<p>Bringing data science to production is a hot topic right now and there are many facets 
to it. This is the first in a series of posts about <em>data science in production</em> and
focuses on aspects of modern software engineering like <em>packaging</em>, <em>versioning</em> as
well as <em>Continuous Integration</em> in&nbsp;general.</p>
<h1>Packages vs.&nbsp;Scripts</h1>
<p>Being a data scientist does not free you from proper software engineering. Of course
most models start with a simple script or a Jupyter notebook maybe, just the essence
of the your idea to test it quickly. But as your model evolves, the number of lines
of code grow, it&#8217;s always a good idea to think about the structure of your code and to
move away from writing simple scripts to proper applications or&nbsp;libraries. </p>
<p>In case of a Python model, that means grouping functionality into different modules 
<a href="https://en.wikipedia.org/wiki/Separation_of_concerns">separating different concerns</a> which could be organised in Python packages on a higher
level. Maybe certain parts of the model are even so general that they could be packaged 
into an own library for greater reusability also for other projects. In the context
of Python, a bundle of software to be installed like a library or application is denoted 
with the term <em>package</em>. Another synonym is <em>distribution</em> which is easily to be confused with
a Linux distribution. Therefore the term package is more commonly used although there is an
ambiguity with the kind of package you import in your Python source code (i.e. a container of&nbsp;modules).</p>
<p>So what is now the key difference between a bunch of Python scripts with some modules 
and a proper package? A Python package adheres a certain structure and thus can be shipped and 
installed by others. Simple as it sounds this is a major advantage over having just some Python 
modules inside a repository. With a package it is possible
to make distinct code releases with different versions that can be stored for later reference. 
Dependencies like <em>numpy</em> and <em>scikit-learn</em> can be specified and dependency resolution is automated
by tools like <a href="https://pip.pypa.io/">pip</a> and <a href="https://conda.io/">conda</a>. Why is this so important? When bugs in production occur 
it&#8217;s incredibly useful to know which state of your code actually is in production. Is it still
version 0.9 or already 1.0? Did the bug also occur in the last release? Most debugging starts
with reproducing the bug locally on your machine. But what if the release is already half a 
year old and there where major changes in its requirements? Maybe the bug is caused by one of
its dependencies? If your package also includes its dependencies with pinned versions 
restoring the exact some state as in production but inside a local <a href="https://virtualenv.pypa.io/">virtualenv</a> or <a href="https://conda.io/">conda</a> environment 
will be a matter of&nbsp;seconds.</p>
<h1>Packaging and&nbsp;Versioning</h1>
<p>Python&#8217;s history of packaging has had its dark times but nowadays things have pretty much settled 
and now there is only one obvious tool left to do it, namely <a href="https://setuptools.readthedocs.io/">setuptools</a>. 
A Python <a href="https://packaging.python.org/tutorials/distributing-packages/">packaging tutorial</a> explains the various steps needed to set up a proper <code>setup.py</code>
but it takes a long time to really master the subtleties of Python packaging and even then it
is quite cumbersome. This is the reason many developers refrain from building Python packages.
Another reason is that even if you have a proper Python package set up, proper versioning is
still a manual and thus error-prone process. Therefore the tool <a href="https://github.com/pypa/setuptools_scm">setuptools_scm</a> exists which
draws the current version automatically from git so a new release is as simple as creating a new tag.
Following the famous Unix principle &#8220;Do one thing and do it well&#8221; also a Python package is
composed of many specialised tools. Besides <a href="https://setuptools.readthedocs.io/">setuptools</a> and <a href="https://github.com/pypa/setuptools_scm">setuptools_scm</a> there 
is <a href="http://www.sphinx-doc.org/">sphinx</a> for documentation, testing tools like <a href="https://docs.pytest.org/">pytest</a> and <a href="https://tox.readthedocs.io/">tox</a> as well as many other
little helpers to consider when setting up a Python package. Already scared off of Python packaging?
Hold your breath, there is no reason to&nbsp;be.</p>
<h2>PyScaffold</h2>
<p>Luckily there is one tool to rule them all, <a href="http://pyscaffold.org/">PyScaffold</a>, which provides a proper Python 
package within a second. It is installed easily&nbsp;with</p>
<div class="highlight"><pre><span></span>pip install pyscaffold
</pre></div>


<p>or </p>
<div class="highlight"><pre><span></span>conda install pyscaffold
</pre></div>


<p>if you prefer <a href="https://conda.io/">conda</a> over <a href="https://pip.pypa.io/">pip</a>. Generating now a project <code>Scikit-AI</code> with a package <code>skai</code> is just 
a matter of typing a single&nbsp;command:</p>
<div class="highlight"><pre><span></span>putup Scikit-AI -p skai
</pre></div>


<p>This will create a git repository <code>Scikit-AI</code> including a fully configured <code>setup.py</code> that can be configured easily
and in a descriptive way by modifying <code>setup.cfg</code>. The typical Python package structure is provided including
subfolders such as <code>docs</code> for <a href="http://www.sphinx-doc.org/">sphinx</a> documentation, <code>tests</code> for unit testing as well as a <code>src</code>
subfolder including the actual Python package <code>skai</code>. Also <a href="https://github.com/pypa/setuptools_scm">setuptools_scm</a> is integrated
and other features can be activates optionally like support for <a href="https://travis-ci.org/">Travis</a>, <a href="https://gitlab.com/">Gitlab</a>, <a href="https://tox.readthedocs.io/">tox</a>, <a href="http://pre-commit.com/">pre-commit</a>
and many&nbsp;more.</p>
<p>An example of a more advanced usage of PyScaffold&nbsp;is</p>
<div class="highlight"><pre><span></span>putup Scikit-AI -p skai --travis --tox -d <span class="s2">&quot;Scientific AI library with a twist&quot;</span> -u <span class="s2">&quot;http://sky.net/&quot;</span>
</pre></div>


<p>where also example configuration files for Travis and tox will be created. The additionally provided short description
with the flag <code>-d</code> is used where appropriate as is the url passed by <code>-u</code>. As usual with shell commands,
<code>putup --help</code> provides information about the various&nbsp;arguments.</p>
<h2>Versioning</h2>
<p>Having a proper Python package already gives us the possibility to ship something that can be installed by others
easily including its dependencies of course. But if you want to move fast also the deployment of your new model
package needs to be as much automated as possible. You want to make sure that bug fixes end up in production
automatically while new features need to be manually&nbsp;approved. </p>
<p>For this reason <a href="https://semver.org/">Semantic Versioning</a> was developed which basically says that a version number is composed of
<span class="caps">MAJOR</span>.<span class="caps">MINOR</span>.<span class="caps">PATCH</span> and you increment&nbsp;the:</p>
<ol>
<li><span class="caps">MAJOR</span> version when you make incompatible <span class="caps">API</span>&nbsp;changes,</li>
<li><span class="caps">MINOR</span> version when you add functionality in a backwards-compatible manner,&nbsp;and</li>
<li><span class="caps">PATCH</span> version when you make backwards-compatible bug&nbsp;fixes.</li>
</ol>
<p>This programming language independent concept also made its way into Python&#8217;s official version identification <a href="https://www.python.org/dev/peps/pep-0440/"><span class="caps">PEP440</span></a>.
Besides <span class="caps">MAJOR</span>, <span class="caps">MINOR</span> and <span class="caps">PATCH</span> the version number is also extended by semantics identifying development, post and pre 
releases. A package that was set up with PyScaffold uses the information from git to generate a <a href="https://www.python.org/dev/peps/pep-0440/"><span class="caps">PEP440</span></a> compatible,
semantic  version identifier. A developer just needs to follow the conventions of <a href="https://semver.org/">Semantic Versioning</a> when tagging a
release with&nbsp;git. </p>
<p>Versioning becomes even more important when your company develops many interdependent packages. The effort of sticking
to the simple conventions of <a href="https://semver.org/">Semantic Versioning</a> right from the start is just a small price to pay compared to 
the myriad of pains in the <a href="https://en.wikipedia.org/wiki/Dependency_hell">dependency hell</a> you will otherwise end up in long-term. Believe me on that&nbsp;one.</p>
<h1>Continuous&nbsp;Integration</h1>
<p>Now that we know about packaging and versioning the next step is to establish an automated Continuous Integration (<span class="caps">CI</span>)
process. For this purpose a common choice is <a href="https://jenkins-ci.org/">Jenkins</a> especially for proprietary software since it can be installed
on&nbsp;premise. </p>
<h2>Artefact&nbsp;Store</h2>
<p>Besides the <span class="caps">CI</span> tool there is also a place needed to store the built packages. The term <em>artefact store</em> is
used commonly for a service that offers a way to store and install packages from. In the Python world the 
Python Package Index (<a href="https://pypi.python.org">PyPI</a>) is the official artefact store to publish open source packages. For companies the
on-premise equivalent is <a href="https://devpi.net/">devpi</a>&nbsp;that:</p>
<ul>
<li>acts as a PyPI&nbsp;mirror, </li>
<li>allows uploading, testing and staging with private&nbsp;indexes,</li>
<li>has a nice web interface for&nbsp;searching,</li>
<li>allows uploading and browsing the Sphinx documentation of&nbsp;packages,</li>
<li>has user management&nbsp;and</li>
<li>features Jenkins&nbsp;integration.</li>
</ul>
<p>If all you care about is Python then devpi is the right artefact store for you. In most companies also Java is used
and <a href="http://www.sonatype.org/nexus/">Nexus</a> often serves thereby already as artefact store. In this case it might be more advantageous to use Nexus also for
storing Python packages which is available since version 3.0 to avoid the complexity of maintaining another&nbsp;service.</p>
<p>In highly polylingual environments with many languages like Python, R, Java and C/C++ this will lead to many different
artefact stores and various different ways of installing artefacts. A unified approach is provided by <a href="https://conda.io/">conda</a> since
conda packages can be built for <a href="https://conda.io/docs/user-guide/tutorials/build-postgis.html">general code projects</a>. The on-premise artefact store provided by <a href="https://anaconda.org/">Anaconda</a> is
called <a href="https://docs.anaconda.com/anaconda-repository/">anaconda-repository</a> and is part of the proprietary enterprise server. Whenever a unified approach to storing and
installing artefacts of different languages is a major concern, <a href="https://anaconda.org/">Anaconda</a> might be a viable&nbsp;solution.</p>
<h2>Indices and&nbsp;Channels</h2>
<p>Common to all artifact stores is the availability of different <em>indices</em> (or <em>channels</em> in conda) to organize artefacts. 
It is a good practice to have different indices to describe the maturity of the contained packages like <em>unstable</em>,
<em>testing</em> and <em>stable</em>. This complements the automatic <a href="https://www.python.org/dev/peps/pep-0440/"><span class="caps">PEP440</span></a> versioning with <a href="http://pyscaffold.org/">PyScaffold</a> since it allows us to 
tell a development version which passed the unit tests (<em>testing</em>) from a development version which did not (<em>unstable</em>).<br>
Since <a href="https://pip.pypa.io/">pip</a> by default installs only stable releases, e.g. <code>1.0</code> but not <code>1.0b3</code>, while the <code>--pre</code> flag 
is needed to install unstable releases the differentiation between <em>testing</em> and <em>stable</em> indices is not absolutely 
necessary. Still for organisational reasons, having an <em>testing</em> index as input for <span class="caps">QA</span> and a <em>stable</em> index that really
only holds releases that passed the whole <span class="caps">QA</span> process is a good idea. Also <a href="https://conda.io/">conda</a> does not seem to provide an equivalent
to the <code>-pre</code> flag and different channels need to be&nbsp;used.</p>
<p>One should also note that git allows to tag a single commit several times which will lead to different versions of the
Python package having the same content. This gives means to the following convention: Let&#8217;s say there was a bug in version
<code>1.2</code> and after two commits the bug seems to be fixed. The automatically inferred version number by PyScaffold
will be <code>1.2.post0.pre2-gHASH</code>. Being happy with her fix the developer tags the commit with <code>1.2.1rc1</code> (first release
candidate of version 1.2.1). Since all unit tests pass this patch will end up in the <em>testing</em> index where <span class="caps">QA</span> can put it to the
acid test. After that, the same commit will be tagged and signed by <span class="caps">QA</span> with name <code>1.2.1</code> which results in a new package
that can be moved to the <em>stable</em> index&nbsp;automatically.</p>
<h2>Automated <span class="caps">CI</span>&nbsp;Processs</h2>
<p>With this components in mind we can establish an automated <span class="caps">CI</span> process. Upon a new commit on a central git repository 
the <em>packaging</em> Jenkins job clones the repo and builds the package, e.g. with <code>python setup.py bdist_wheel</code>. If this is
successful the package is uploaded to the <em>unstable</em> index of the artefact store. Upon the successful completion of the
packaging job a second Jenkins job for <em>testing</em> is triggered. The reason for packaging and publishing before running
any kind of unit tests is that already during the packaging can be major flaws that a typical unit test could never
find. For instance, missing data files that are in the repo but not specified in the package, missing or wrong
dependencies and so on. Therefore it is important to run unit tests always against the package installed in a clean
environment and that is exactly what the testing job does. After having set up a fresh environment with <a href="https://virtualenv.pypa.io/">virtualenv</a>
or <a href="https://conda.io/">conda</a> the just published package is installed from the artefact store. 
If this succeeds the git repo is cloned into a subfolder providing
the unit tests (in the <code>tests</code> subfolder). These unit tests are then executed and check the installed package. In case
that all tests pass the package is moved from the <em>unstable</em> index to the <em>testing</em> index. In case the commit was
tagged as a stable release and thus the package&#8217;s version is stable according to <a href="https://www.python.org/dev/peps/pep-0440/"><span class="caps">PEP440</span></a> it is moved into the
 <em>stable</em> index. Figure 1 illustrates the complete&nbsp;process.</p>
<figure>
<p align="center">
<img class="noZoom" src="/images/ci_build_publish.png" alt="Building and publishing a package">
<figcaption><strong>Figure 1:</strong> The <em>packaging</em> job clones source code repository, builds the software package and pushes
it into the <em>unstable</em> index of the artefact store. If these steps succeed the <em>testing</em> job
is triggered which installs the package from the artefact store and its dependencies into a clean environment.
The source code reposistory is then cloned in order to run the unit tests against the installed package. If all 
unit tests pass the package is moved into the <em>testing</em> index of the artefact store or optionally
to the <em>stable</em> index if the version is a stable release.</figcaption>
</p>
</figure>

<h1>Conclusion</h1>
<p>It is clear that packaging, versioning and <span class="caps">CI</span> are just one aspect of how to bring Data Science in production. 
Follow-up posts will shed some light on other aspects.
Nevertheless these are quite important but often their benefits are underestimated. We have seen that proper packaging is
crucial to shipping, installing a package and dealing with its dependencies. Semantic Versioning supports us in automation
of rolling out patches and in the organisation of deployment. The advantages of Continous Integration are quite obvious
and promoted a lot by the DevOps culture in recent years. Also Data Science can learn and benefit from this spirit and
we have seen that a minimal <span class="caps">CI</span> setup is easy to accomplish. All together they build a fundamental corner stone of
Data Science in&nbsp;production.</p>
<p>Some good talks around this topic were held by <a href="https://www.linkedin.com/in/sebastian-neubauer-16626a79/">Sebastian Neubauer</a>, one of the acclaimed
DevOps rock stars of Python in production. His talks <a href="https://www.youtube.com/watch?v=Ad9qSbrfnvk">A Pythonic Approach to <span class="caps">CI</span></a> and 
<a href="https://www.youtube.com/watch?v=hnQKsxKjCUo">There should be one obvious way to bring Python into production</a> perfectly complement this post and are even fun 
to&nbsp;watch.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="http://www.florianwilhelm.info/2016/02/introduction_to_the_python_data_science_stack/">Introduction to the Python Data Science&nbsp;Stack</a></li>
        <li><a href="http://www.florianwilhelm.info/2017/10/efficient_udfs_with_pyspark/">Efficient <span class="caps">UD</span>(A)Fs with&nbsp;PySpark</a></li>
        <li><a href="http://www.florianwilhelm.info/2017/07/declarative_thinking_and_programming/">Declarative Thinking and&nbsp;Programming</a></li>
        <li><a href="http://www.florianwilhelm.info/2017/07/which_car_fits_my_life/">“Which car fits my life?” - mobile.de’s approach to&nbsp;recommendations</a></li>
        <li><a href="http://www.florianwilhelm.info/2017/04/causal_inference_propensity_score/">Causal Inference and Propensity Score&nbsp;Methods</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'florianwilhelmblog'; // required: replace example with your forum shortname

                    var disqus_identifier = 'ds_in_prod_packaging_ci';
                var disqus_url = 'http://www.florianwilhelm.info/drafts/ds_in_prod_packaging_ci.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
        <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://twitter.com/FlorianWilhelm"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                <li class="list-group-item"><a href="https://linkedin.com/in/florian-wilhelm-621ba834"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>
                <li class="list-group-item"><a href="https://github.com/FlorianWilhelm"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
              </ul>
            </li>



            <li class="list-group-item"><a href="http://www.florianwilhelm.info/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/asynchronous/">
                            asynchronous
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/asyncio/">
                            asyncio
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/bayesian/">
                            bayesian
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.florianwilhelm.info/tag/big-data/">
                            big data
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/blue-yonder/">
                            Blue Yonder
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/bokeh/">
                            bokeh
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/causal-inference/">
                            causal inference
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.florianwilhelm.info/tag/data-science/">
                            data science
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/event-driven/">
                            event-driven
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/google-hangouts/">
                            google hangouts
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/gps/">
                            gps
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/hadoop/">
                            hadoop
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/hive/">
                            hive
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.florianwilhelm.info/tag/jupyter/">
                            jupyter
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/kalman/">
                            kalman
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.florianwilhelm.info/tag/machine-learning/">
                            machine-learning
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.florianwilhelm.info/tag/predictive-analytics/">
                            predictive analytics
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/programming/">
                            programming
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://www.florianwilhelm.info/tag/python/">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/recommendation-system/">
                            recommendation system
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.florianwilhelm.info/tag/scikit-learn/">
                            scikit-learn
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/scipy/">
                            scipy
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/spark/">
                            spark
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.florianwilhelm.info/tag/template/">
                            template
                        </a>
                    </li>
                </ul>
            </li>


    </ul>
</section>            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Florian Wilhelm
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://www.florianwilhelm.info/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://www.florianwilhelm.info/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://www.florianwilhelm.info/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'florianwilhelmblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-71694209-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>